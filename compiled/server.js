'use strict';

var handler = require('./lib/request-handler.js'),
    express = require('express'),
    app = express(),
    bodyParser = require('body-parser'),
    sessions = require("client-sessions"),
    cors = require('cors'),
    compression = require('compression');


app.get('*', function (a, b, c) {
  if (a.headers['x-forwarded-proto'] !== 'https') {
    b.redirect('https://' + a.hostname + a.url);
  } else {
    c();
  }
});

app.use(cors());
app.use(sessions({
  cookieName: 'mySession', // cookie name dictates the key name added to the request object
  secret: 'blargadeeblargblarg', // should be a large unguessable string
  resave: !0,
  duration: 24 * 60 * 60 * 1000, // how long the session will stay valid in ms
  activeDuration: 1000 * 60 * 5, // if expiresIn < activeDuration, the session will be extended by activeDuration milliseconds
  saveInitialized: !0
}));

app.use(compression());
app.use(bodyParser.urlencoded({ extended: !0 }));
app.use(bodyParser.json());

app.use(express.static(__dirname + '/public', { maxAge: 3600 * 24 * 1000 }));
app.use('/scripts', express.static(__dirname + '/node_modules', { maxAge: 3600 * 24 * 1000 }));
app.use('/compiled', express.static(__dirname + '/compiled', { maxAge: 3600 * 24 * 1000 }));

app.post('/signup', handler.signupUser);
app.post('/login', handler.signinUser);

//////////////////
//Handling friends
//////////////////

//friend requests
app.post('/listRequests', handler.listRequests);
app.post('/sendRequest', handler.sendRequest);
//Friend requests
app.post('/getThisFriendsMovies', handler.getThisFriendsMovies);
app.post('/logout', handler.logout);

app.post('/sendWatchRequest', handler.sendWatchRequest);
app.delete('/sendWatchRequest', handler.removeWatchRequest);

app.post('/decline', handler.decline);
app.post('/accept', handler.accept);
app.delete('/removeRequest', handler.removeRequest);

app.post('/findMovieBuddies', handler.findMovieBuddies);
app.post('/getFriends', handler.getFriends);
app.get('/getFriendList', handler.getFriendList);

//////////////////
//Handling movies
//////////////////
app.post('/ratemovie', handler.rateMovie);
app.get('/recentRelease', handler.getRecentRelease);
app.get('/getUserRatings', handler.getUserRatings);
app.get('/getFriendUserRatings', handler.getFriendUserRatings);
app.post('/getMultipleMovieRatings', handler.getMultipleMovieRatings);
app.post('/getFriendRatings', handler.handleGetFriendRatings);
app.get('/searchRatedMovie', handler.searchRatedMovie);

app.get('/*', function (a, b) {
  b.redirect('/');
});

var port = process.env.PORT || 3000;
app.listen(port, function () {});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NlcnZlci5qcyJdLCJuYW1lcyI6WyJoYW5kbGVyIiwicmVxdWlyZSIsImV4cHJlc3MiLCJhcHAiLCJib2R5UGFyc2VyIiwic2Vzc2lvbnMiLCJjb3JzIiwiY29tcHJlc3Npb24iLCJnZXQiLCJyZXEiLCJyZXMiLCJuZXh0IiwiaGVhZGVycyIsInJlZGlyZWN0IiwiaG9zdG5hbWUiLCJ1cmwiLCJ1c2UiLCJjb29raWVOYW1lIiwic2VjcmV0IiwicmVzYXZlIiwiZHVyYXRpb24iLCJhY3RpdmVEdXJhdGlvbiIsInNhdmVJbml0aWFsaXplZCIsInVybGVuY29kZWQiLCJleHRlbmRlZCIsImpzb24iLCJzdGF0aWMiLCJfX2Rpcm5hbWUiLCJtYXhBZ2UiLCJwb3N0Iiwic2lnbnVwVXNlciIsInNpZ25pblVzZXIiLCJsaXN0UmVxdWVzdHMiLCJzZW5kUmVxdWVzdCIsImdldFRoaXNGcmllbmRzTW92aWVzIiwibG9nb3V0Iiwic2VuZFdhdGNoUmVxdWVzdCIsImRlbGV0ZSIsInJlbW92ZVdhdGNoUmVxdWVzdCIsImRlY2xpbmUiLCJhY2NlcHQiLCJyZW1vdmVSZXF1ZXN0IiwiZmluZE1vdmllQnVkZGllcyIsImdldEZyaWVuZHMiLCJnZXRGcmllbmRMaXN0IiwicmF0ZU1vdmllIiwiZ2V0UmVjZW50UmVsZWFzZSIsImdldFVzZXJSYXRpbmdzIiwiZ2V0RnJpZW5kVXNlclJhdGluZ3MiLCJnZXRNdWx0aXBsZU1vdmllUmF0aW5ncyIsImhhbmRsZUdldEZyaWVuZFJhdGluZ3MiLCJzZWFyY2hSYXRlZE1vdmllIiwicG9ydCIsInByb2Nlc3MiLCJlbnYiLCJQT1JUIiwibGlzdGVuIl0sIm1hcHBpbmdzIjoiOztBQUNBLElBQUlBLFVBQVVDLFFBQVEsMEJBQVIsQ0FBZDtBQUFBLElBQ0lDLFVBQVVELFFBQVEsU0FBUixDQURkO0FBQUEsSUFFSUUsTUFBTUQsU0FGVjtBQUFBLElBR0lFLGFBQWFILFFBQVEsYUFBUixDQUhqQjtBQUFBLElBSUlJLFdBQVdKLFFBQVEs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QUFJSyxHQUFKLENBQVEsZ0JBQVIsRUFBMEJSLFFBQVE4QyxnQkFBbEM7QUFDQTNDLElBQUlLLEdBQUosQ0FBUSxpQkFBUixFQUEyQlIsUUFBUStDLGNBQW5DO0FBQ0E1QyxJQUFJSyxHQUFKLENBQVEsdUJBQVIsRUFBaUNSLFFBQVFnRCxvQkFBekM7QUFDQTdDLElBQUkwQixJQUFKLENBQVMsMEJBQVQsRUFBcUM3QixRQUFRaUQsdUJBQTdDO0FBQ0E5QyxJQUFJMEIsSUFBSixDQUFTLG1CQUFULEVBQThCN0IsUUFBUWtELHNCQUF0QztBQUNBL0MsSUFBSUssR0FBSixDQUFRLG1CQUFSLEVBQTZCUixRQUFRbUQsZ0JBQXJDOztBQUdBaEQsSUFBSUssR0FBSixDQUFRLElBQVIsRUFBYyxVQUFTQyxDQUFULEVBQWNDLENBQWQsRUFBbUI7QUFDN0JBLElBQUlHLFFBQUosQ0FBYSxHQUFiO0FBQ0gsQ0FGRDs7QUFJQSxJQUFJdUMsT0FBT0MsUUFBUUMsR0FBUixDQUFZQyxJQUFaLElBQW9CLElBQS9CO0FBQ0FwRCxJQUFJcUQsTUFBSixDQUFXSixJQUFYLEVBQWlCLFlBQVksQ0FFNUIsQ0FGRCIsImZpbGUiOiJzZXJ2ZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcclxudmFyIGhhbmRsZXIgPSByZXF1aXJlKCcuL2xpYi9yZXF1ZXN0LWhhbmRsZXIuanMnKTtcclxudmFyIGV4cHJlc3MgPSByZXF1aXJlKCdleHByZXNzJyk7XHJcbnZhciBhcHAgPSBleHByZXNzKCk7XHJcbnZhciBib2R5UGFyc2VyID0gcmVxdWlyZSgnYm9keS1wYXJzZXInKTtcclxudmFyIHNlc3Npb25zID0gcmVxdWlyZShcImNsaWVudC1zZXNzaW9uc1wiKTtcclxudmFyIGNvcnMgPSByZXF1aXJlKCdjb3JzJyk7XHJcbnZhciBjb21wcmVzc2lvbiA9IHJlcXVpcmUoJ2NvbXByZXNzaW9uJyk7XHJcblxyXG5cclxuYXBwLmdldCgnKicsIGZ1bmN0aW9uKHJlcSxyZXMsbmV4dCkge1xyXG4gIGlmIChyZXEuaGVhZGVyc1sneC1mb3J3YXJkZWQtcHJvdG8nXSAhPT0gJ2h0dHBzJykge1xyXG4gICAgcmVzLnJlZGlyZWN0KCdodHRwczovLycgKyByZXEuaG9zdG5hbWUgKyByZXEudXJsKTtcclxuICB9IGVsc2Uge1xyXG4gICAgbmV4dCgpO1xyXG4gIH1cclxufSk7XHJcblxyXG5hcHAudXNlKGNvcnMoKSk7XHJcbmFwcC51c2Uoc2Vzc2lvbnMoe1xyXG4gIGNvb2tpZU5hbWU6ICdteVNlc3Npb24nLCAvLyBjb29raWUgbmFtZSBkaWN0YXRlcyB0aGUga2V5IG5hbWUgYWRkZWQgdG8gdGhlIHJlcXVlc3Qgb2JqZWN0XHJcbiAgc2VjcmV0OiAnYmxhcmdhZGVlYmxhcmdibGFyZycsIC8vIHNob3VsZCBiZSBhIGxhcmdlIHVuZ3Vlc3NhYmxlIHN0cmluZ1xyXG4gIHJlc2F2ZTogdHJ1ZSxcclxuICBkdXJhdGlvbjogMjQgKiA2MCAqIDYwICogMTAwMCwgLy8gaG93IGxvbmcgdGhlIHNlc3Npb24gd2lsbCBzdGF5IHZhbGlkIGluIG1zXHJcbiAgYWN0aXZlRHVyYXRpb246IDEwMDAgKiA2MCAqIDUsIC8vIGlmIGV4cGlyZXNJbiA8IGFjdGl2ZUR1cmF0aW9uLCB0aGUgc2Vzc2lvbiB3aWxsIGJlIGV4dGVuZGVkIGJ5IGFjdGl2ZUR1cmF0aW9uIG1pbGxpc2Vjb25kc1xyXG4gIHNhdmVJbml0aWFsaXplZDogdHJ1ZVxyXG59KSk7XHJcblxyXG5hcHAudXNlKGNvbXByZXNzaW9uKCkpO1xyXG5hcHAudXNlKGJvZHlQYXJzZXIudXJsZW5jb2RlZCh7ZXh0ZW5kZWQ6IHRydWV9KSk7XHJcbmFwcC51c2UoYm9keVBhcnNlci5qc29uKCkpO1xyXG5cclxuYXBwLnVzZShleHByZXNzLnN0YXRpYyhfX2Rpcm5hbWUgKyAnL3B1YmxpYycsIHttYXhBZ2U6MzYwMCoyNCAqMTAwMH0pKTtcclxuYXBwLnVzZSgnL3NjcmlwdHMnLCBleHByZXNzLnN0YXRpYyhfX2Rpcm5hbWUgKyAnL25vZGVfbW9kdWxlcycsIHttYXhBZ2U6MzYwMCoyNCoxMDAwfSkpO1xyXG5hcHAudXNlKCcvY29tcGlsZWQnLCBleHByZXNzLnN0YXRpYyhfX2Rpcm5hbWUgKyAnL2NvbXBpbGVkJywge21heEFnZTozNjAwKjI0KjEwMDB9KSk7XHJcblxyXG5cclxuYXBwLnBvc3QoJy9zaWdudXAnLCBoYW5kbGVyLnNpZ251cFVzZXIpO1xyXG5hcHAucG9zdCgnL2xvZ2luJywgaGFuZGxlci5zaWduaW5Vc2VyKTtcclxuXHJcblxyXG4vLy8vLy8vLy8vLy8vLy8vLy9cclxuLy9IYW5kbGluZyBmcmllbmRzXHJcbi8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuLy9mcmllbmQgcmVxdWVzdHNcclxuYXBwLnBvc3QoJy9saXN0UmVxdWVzdHMnLCBoYW5kbGVyLmxpc3RSZXF1ZXN0cyk7XHJcbmFwcC5wb3N0KCcvc2VuZFJlcXVlc3QnLCBoYW5kbGVyLnNlbmRSZXF1ZXN0KTtcclxuLy9GcmllbmQgcmVxdWVzdHNcclxuYXBwLnBvc3QoJy9nZXRUaGlzRnJpZW5kc01vdmllcycsaGFuZGxlci5nZXRUaGlzRnJpZW5kc01vdmllcylcclxuYXBwLnBvc3QoJy9sb2dvdXQnLCBoYW5kbGVyLmxvZ291dCk7XHJcblxyXG5hcHAucG9zdCgnL3NlbmRXYXRjaFJlcXVlc3QnLGhhbmRsZXIuc2VuZFdhdGNoUmVxdWVzdClcclxuYXBwLmRlbGV0ZSgnL3NlbmRXYXRjaFJlcXVlc3QnLCBoYW5kbGVyLnJlbW92ZVdhdGNoUmVxdWVzdClcclxuXHJcbmFwcC5wb3N0KCcvZGVjbGluZScsIGhhbmRsZXIuZGVjbGluZSk7XHJcbmFwcC5wb3N0KCcvYWNjZXB0JywgaGFuZGxlci5hY2NlcHQpO1xyXG5hcHAuZGVsZXRlKCcvcmVtb3ZlUmVxdWVzdCcsIGhhbmRsZXIucmVtb3ZlUmVxdWVzdClcclxuXHJcbmFwcC5wb3N0KCcvZmluZE1vdmllQnVkZGllcycsaGFuZGxlci5maW5kTW92aWVCdWRkaWVzKVxyXG5hcHAucG9zdCgnL2dldEZyaWVuZHMnLGhhbmRsZXIuZ2V0RnJpZW5kcylcclxuYXBwLmdldCgnL2dldEZyaWVuZExpc3QnLCBoYW5kbGVyLmdldEZyaWVuZExpc3QpXHJcblxyXG5cclxuLy8vLy8vLy8vLy8vLy8vLy8vXHJcbi8vSGFuZGxpbmcgbW92aWVzXHJcbi8vLy8vLy8vLy8vLy8vLy8vL1xyXG5hcHAucG9zdCgnL3JhdGVtb3ZpZScsIGhhbmRsZXIucmF0ZU1vdmllKTtcclxuYXBwLmdldCgnL3JlY2VudFJlbGVhc2UnLCBoYW5kbGVyLmdldFJlY2VudFJlbGVhc2UpO1xyXG5hcHAuZ2V0KCcvZ2V0VXNlclJhdGluZ3MnLCBoYW5kbGVyLmdldFVzZXJSYXRpbmdzKTtcclxuYXBwLmdldCgnL2dldEZyaWVuZFVzZXJSYXRpbmdzJywgaGFuZGxlci5nZXRGcmllbmRVc2VyUmF0aW5ncyk7XHJcbmFwcC5wb3N0KCcvZ2V0TXVsdGlwbGVNb3ZpZVJhdGluZ3MnLCBoYW5kbGVyLmdldE11bHRpcGxlTW92aWVSYXRpbmdzKTtcclxuYXBwLnBvc3QoJy9nZXRGcmllbmRSYXRpbmdzJywgaGFuZGxlci5oYW5kbGVHZXRGcmllbmRSYXRpbmdzKTtcclxuYXBwLmdldCgnL3NlYXJjaFJhdGVkTW92aWUnLCBoYW5kbGVyLnNlYXJjaFJhdGVkTW92aWUpO1xyXG5cclxuXHJcbmFwcC5nZXQoJy8qJywgZnVuY3Rpb24ocmVxLCByZXMpIHtcclxuICAgIHJlcy5yZWRpcmVjdCgnLycpO1xyXG59KTtcclxuXHJcbnZhciBwb3J0ID0gcHJvY2Vzcy5lbnYuUE9SVCB8fCAzMDAwO1xyXG5hcHAubGlzdGVuKHBvcnQsIGZ1bmN0aW9uICgpIHtcclxuICBjb25zb2xlLmxvZygnTGlzdGVuaW5nIG9uIHBvcnQgMzAwMCEnKTtcclxufSk7Il19