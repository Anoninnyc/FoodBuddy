'use strict';

var handler = require('./lib/request-handler.js');
var express = require('express');
var app = express();
var bodyParser = require('body-parser');
var sessions = require("client-sessions");
var cors = require('cors');

app.get('*', function (req, res, next) {
  if (req.headers['x-forwarded-proto'] !== 'https') {
    res.redirect('https://' + req.hostname + req.url);
  } else {
    next();
  }
});

app.use(cors());
app.use(sessions({
  cookieName: 'mySession', // cookie name dictates the key name added to the request object
  secret: 'blargadeeblargblarg', // should be a large unguessable string
  resave: true,
  duration: 24 * 60 * 60 * 1000, // how long the session will stay valid in ms
  activeDuration: 1000 * 60 * 5, // if expiresIn < activeDuration, the session will be extended by activeDuration milliseconds
  saveInitialized: true
}));

app.use(bodyParser.urlencoded({ extended: true }));
app.use(bodyParser.json());
app.use(express.static(__dirname + '/public'));
app.use('/scripts', express.static(__dirname + '/node_modules'));
app.use('/compiled', express.static(__dirname + '/compiled'));

app.post('/signup', handler.signupUser);
app.post('/login', handler.signinUser);
app.get('/login', function (req, res) {
  console.log('loeijwfloejfelifjdp');
});

//////////////////
//Handling friends
//////////////////

//friend requests
app.post('/listRequests', handler.listRequests);
app.post('/sendRequest', handler.sendRequest);
//Friend requests
app.post('/getThisFriendsMovies', handler.getThisFriendsMovies);
app.post('/logout', handler.logout);

app.post('/sendWatchRequest', handler.sendWatchRequest);
app.delete('/sendWatchRequest', handler.removeWatchRequest);

app.post('/decline', handler.decline);
app.post('/accept', handler.accept);
app.delete('/removeRequest', handler.removeRequest);

app.post('/findMovieBuddies', handler.findMovieBuddies);
app.post('/getFriends', handler.getFriends);
app.get('/getFriendList', handler.getFriendList);

//////////////////
//Handling movies
//////////////////
app.post('/ratemovie', handler.rateMovie);
app.get('/recentRelease', handler.getRecentRelease);
app.get('/getUserRatings', handler.getUserRatings);
app.get('/getFriendUserRatings', handler.getFriendUserRatings);
app.post('/getMultipleMovieRatings', handler.getMultipleMovieRatings);
app.post('/getFriendRatings', handler.handleGetFriendRatings);
app.get('/searchRatedMovie', handler.searchRatedMovie);

var port = process.env.PORT || 3000;
app.listen(port, function () {
  console.log('Listening on port 3000!');
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NlcnZlci5qcyJdLCJuYW1lcyI6WyJoYW5kbGVyIiwicmVxdWlyZSIsImV4cHJlc3MiLCJhcHAiLCJib2R5UGFyc2VyIiwic2Vzc2lvbnMiLCJjb3JzIiwiZ2V0IiwicmVxIiwicmVzIiwibmV4dCIsImhlYWRlcnMiLCJyZWRpcmVjdCIsImhvc3RuYW1lIiwidXJsIiwidXNlIiwiY29va2llTmFtZSIsInNlY3JldCIsInJlc2F2ZSIsImR1cmF0aW9uIiwiYWN0aXZlRHVyYXRpb24iLCJzYXZlSW5pdGlhbGl6ZWQiLCJ1cmxlbmNvZGVkIiwiZXh0ZW5kZWQiLCJqc29uIiwic3RhdGljIiwiX19kaXJuYW1lIiwicG9zdCIsInNpZ251cFVzZXIiLCJzaWduaW5Vc2VyIiwiY29uc29sZSIsImxvZyIsImxpc3RSZXF1ZXN0cyIsInNlbmRSZXF1ZXN0IiwiZ2V0VGhpc0ZyaWVuZHNNb3ZpZXMiLCJsb2dvdXQiLCJzZW5kV2F0Y2hSZXF1ZXN0IiwiZGVsZXRlIiwicmVtb3ZlV2F0Y2hSZXF1ZXN0IiwiZGVjbGluZSIsImFjY2VwdCIsInJlbW92ZVJlcXVlc3QiLCJmaW5kTW92aWVCdWRkaWVzIiwiZ2V0RnJpZW5kcyIsImdldEZyaWVuZExpc3QiLCJyYXRlTW92aWUiLCJnZXRSZWNlbnRSZWxlYXNlIiwiZ2V0VXNlclJhdGluZ3MiLCJnZXRGcmllbmRVc2VyUmF0aW5ncyIsImdldE11bHRpcGxlTW92aWVSYXRpbmdzIiwiaGFuZGxlR2V0RnJpZW5kUmF0aW5ncyIsInNlYXJjaFJhdGVkTW92aWUiLCJwb3J0IiwicHJvY2VzcyIsImVudiIsIlBPUlQiLCJsaXN0ZW4iXSwibWFwcGluZ3MiOiI7O0FBQ0EsSUFBSUEsVUFBVUMsUUFBUSwwQkFBUixDQUFkO0FBQ0EsSUFBSUMsVUFBVUQsUUFBUSxTQUFSLENBQWQ7QUFDQSxJQUFJRSxNQUFNRCxTQUFWO0FBQ0EsSUFBSUUsYUFBYUgsUUFBUSxhQUFSLENBQWpCO0FBQ0EsSUFBSUksV0FBV0osUUFBUSxpQkFBUixD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QyxjQUFuQztBQUNBNUMsSUFBSUksR0FBSixDQUFRLHVCQUFSLEVBQWlDUCxRQUFRZ0Qsb0JBQXpDO0FBQ0E3QyxJQUFJd0IsSUFBSixDQUFTLDBCQUFULEVBQXFDM0IsUUFBUWlELHVCQUE3QztBQUNBOUMsSUFBSXdCLElBQUosQ0FBUyxtQkFBVCxFQUE4QjNCLFFBQVFrRCxzQkFBdEM7QUFDQS9DLElBQUlJLEdBQUosQ0FBUSxtQkFBUixFQUE2QlAsUUFBUW1ELGdCQUFyQzs7QUFHQSxJQUFJQyxPQUFPQyxRQUFRQyxHQUFSLENBQVlDLElBQVosSUFBb0IsSUFBL0I7QUFDQXBELElBQUlxRCxNQUFKLENBQVdKLElBQVgsRUFBaUIsWUFBWTtBQUMzQnRCLFVBQVFDLEdBQVIsQ0FBWSx5QkFBWjtBQUNELENBRkQiLCJmaWxlIjoic2VydmVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXHJcbnZhciBoYW5kbGVyID0gcmVxdWlyZSgnLi9saWIvcmVxdWVzdC1oYW5kbGVyLmpzJyk7XHJcbnZhciBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xyXG52YXIgYXBwID0gZXhwcmVzcygpO1xyXG52YXIgYm9keVBhcnNlciA9IHJlcXVpcmUoJ2JvZHktcGFyc2VyJyk7XHJcbnZhciBzZXNzaW9ucyA9IHJlcXVpcmUoXCJjbGllbnQtc2Vzc2lvbnNcIik7XHJcbnZhciBjb3JzID0gcmVxdWlyZSgnY29ycycpO1xyXG5cclxuYXBwLmdldCgnKicsIGZ1bmN0aW9uKHJlcSxyZXMsbmV4dCkge1xyXG4gIGlmIChyZXEuaGVhZGVyc1sneC1mb3J3YXJkZWQtcHJvdG8nXSAhPT0gJ2h0dHBzJykge1xyXG4gICAgcmVzLnJlZGlyZWN0KCdodHRwczovLycgKyByZXEuaG9zdG5hbWUgKyByZXEudXJsKTtcclxuICB9IGVsc2Uge1xyXG4gICAgbmV4dCgpO1xyXG4gIH1cclxufSk7XHJcblxyXG5hcHAudXNlKGNvcnMoKSk7XHJcbmFwcC51c2Uoc2Vzc2lvbnMoe1xyXG4gIGNvb2tpZU5hbWU6ICdteVNlc3Npb24nLCAvLyBjb29raWUgbmFtZSBkaWN0YXRlcyB0aGUga2V5IG5hbWUgYWRkZWQgdG8gdGhlIHJlcXVlc3Qgb2JqZWN0XHJcbiAgc2VjcmV0OiAnYmxhcmdhZGVlYmxhcmdibGFyZycsIC8vIHNob3VsZCBiZSBhIGxhcmdlIHVuZ3Vlc3NhYmxlIHN0cmluZ1xyXG4gIHJlc2F2ZTogdHJ1ZSxcclxuICBkdXJhdGlvbjogMjQgKiA2MCAqIDYwICogMTAwMCwgLy8gaG93IGxvbmcgdGhlIHNlc3Npb24gd2lsbCBzdGF5IHZhbGlkIGluIG1zXHJcbiAgYWN0aXZlRHVyYXRpb246IDEwMDAgKiA2MCAqIDUsIC8vIGlmIGV4cGlyZXNJbiA8IGFjdGl2ZUR1cmF0aW9uLCB0aGUgc2Vzc2lvbiB3aWxsIGJlIGV4dGVuZGVkIGJ5IGFjdGl2ZUR1cmF0aW9uIG1pbGxpc2Vjb25kc1xyXG4gIHNhdmVJbml0aWFsaXplZDogdHJ1ZVxyXG59KSk7XHJcblxyXG5hcHAudXNlKGJvZHlQYXJzZXIudXJsZW5jb2RlZCh7ZXh0ZW5kZWQ6IHRydWV9KSk7XHJcbmFwcC51c2UoYm9keVBhcnNlci5qc29uKCkpO1xyXG5hcHAudXNlKGV4cHJlc3Muc3RhdGljKF9fZGlybmFtZSArICcvcHVibGljJykpO1xyXG5hcHAudXNlKCcvc2NyaXB0cycsIGV4cHJlc3Muc3RhdGljKF9fZGlybmFtZSArICcvbm9kZV9tb2R1bGVzJykpO1xyXG5hcHAudXNlKCcvY29tcGlsZWQnLCBleHByZXNzLnN0YXRpYyhfX2Rpcm5hbWUgKyAnL2NvbXBpbGVkJykpO1xyXG5cclxuXHJcbmFwcC5wb3N0KCcvc2lnbnVwJywgaGFuZGxlci5zaWdudXBVc2VyKTtcclxuYXBwLnBvc3QoJy9sb2dpbicsIGhhbmRsZXIuc2lnbmluVXNlcik7XHJcbmFwcC5nZXQoJy9sb2dpbicsZnVuY3Rpb24ocmVxLHJlcyl7XHJcblx0Y29uc29sZS5sb2coJ2xvZWlqd2Zsb2VqZmVsaWZqZHAnKVxyXG59KTtcclxuXHJcbi8vLy8vLy8vLy8vLy8vLy8vL1xyXG4vL0hhbmRsaW5nIGZyaWVuZHNcclxuLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG4vL2ZyaWVuZCByZXF1ZXN0c1xyXG5hcHAucG9zdCgnL2xpc3RSZXF1ZXN0cycsIGhhbmRsZXIubGlzdFJlcXVlc3RzKTtcclxuYXBwLnBvc3QoJy9zZW5kUmVxdWVzdCcsIGhhbmRsZXIuc2VuZFJlcXVlc3QpO1xyXG4vL0ZyaWVuZCByZXF1ZXN0c1xyXG5hcHAucG9zdCgnL2dldFRoaXNGcmllbmRzTW92aWVzJyxoYW5kbGVyLmdldFRoaXNGcmllbmRzTW92aWVzKVxyXG5hcHAucG9zdCgnL2xvZ291dCcsIGhhbmRsZXIubG9nb3V0KTtcclxuXHJcbmFwcC5wb3N0KCcvc2VuZFdhdGNoUmVxdWVzdCcsaGFuZGxlci5zZW5kV2F0Y2hSZXF1ZXN0KVxyXG5hcHAuZGVsZXRlKCcvc2VuZFdhdGNoUmVxdWVzdCcsIGhhbmRsZXIucmVtb3ZlV2F0Y2hSZXF1ZXN0KVxyXG5cclxuYXBwLnBvc3QoJy9kZWNsaW5lJywgaGFuZGxlci5kZWNsaW5lKTtcclxuYXBwLnBvc3QoJy9hY2NlcHQnLCBoYW5kbGVyLmFjY2VwdCk7XHJcbmFwcC5kZWxldGUoJy9yZW1vdmVSZXF1ZXN0JywgaGFuZGxlci5yZW1vdmVSZXF1ZXN0KVxyXG5cclxuYXBwLnBvc3QoJy9maW5kTW92aWVCdWRkaWVzJyxoYW5kbGVyLmZpbmRNb3ZpZUJ1ZGRpZXMpXHJcbmFwcC5wb3N0KCcvZ2V0RnJpZW5kcycsaGFuZGxlci5nZXRGcmllbmRzKVxyXG5hcHAuZ2V0KCcvZ2V0RnJpZW5kTGlzdCcsIGhhbmRsZXIuZ2V0RnJpZW5kTGlzdClcclxuXHJcblxyXG4vLy8vLy8vLy8vLy8vLy8vLy9cclxuLy9IYW5kbGluZyBtb3ZpZXNcclxuLy8vLy8vLy8vLy8vLy8vLy8vXHJcbmFwcC5wb3N0KCcvcmF0ZW1vdmllJywgaGFuZGxlci5yYXRlTW92aWUpO1xyXG5hcHAuZ2V0KCcvcmVjZW50UmVsZWFzZScsIGhhbmRsZXIuZ2V0UmVjZW50UmVsZWFzZSk7XHJcbmFwcC5nZXQoJy9nZXRVc2VyUmF0aW5ncycsIGhhbmRsZXIuZ2V0VXNlclJhdGluZ3MpO1xyXG5hcHAuZ2V0KCcvZ2V0RnJpZW5kVXNlclJhdGluZ3MnLCBoYW5kbGVyLmdldEZyaWVuZFVzZXJSYXRpbmdzKTtcclxuYXBwLnBvc3QoJy9nZXRNdWx0aXBsZU1vdmllUmF0aW5ncycsIGhhbmRsZXIuZ2V0TXVsdGlwbGVNb3ZpZVJhdGluZ3MpO1xyXG5hcHAucG9zdCgnL2dldEZyaWVuZFJhdGluZ3MnLCBoYW5kbGVyLmhhbmRsZUdldEZyaWVuZFJhdGluZ3MpO1xyXG5hcHAuZ2V0KCcvc2VhcmNoUmF0ZWRNb3ZpZScsIGhhbmRsZXIuc2VhcmNoUmF0ZWRNb3ZpZSk7XHJcblxyXG5cclxudmFyIHBvcnQgPSBwcm9jZXNzLmVudi5QT1JUIHx8IDMwMDA7XHJcbmFwcC5saXN0ZW4ocG9ydCwgZnVuY3Rpb24gKCkge1xyXG4gIGNvbnNvbGUubG9nKCdMaXN0ZW5pbmcgb24gcG9ydCAzMDAwIScpO1xyXG59KTsiXX0=